Step 1: Prepare the Worker Node
Update System
bashsudo yum update -y  # For RHEL/CentOS/Rocky/Amazon Linux
# OR
sudo apt update && sudo apt upgrade -y  # For Ubuntu/Debian
Set Hostname
bashsudo hostnamectl set-hostname k8s-worker-01
Disable Swap (Required for Kubernetes)
bashsudo swapoff -a
sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab
Configure SELinux (if applicable)
bash# For RHEL/CentOS/Rocky
sudo setenforce 0
sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config

Step 2: Configure Firewall
For firewalld (RHEL/CentOS/Rocky/Amazon Linux)
bashsudo firewall-cmd --permanent --add-port=10250/tcp  # Kubelet API
sudo firewall-cmd --permanent --add-port=30000-32767/tcp  # NodePort Services
sudo firewall-cmd --reload

# Or disable firewall (easier for testing, not recommended for production)
sudo systemctl stop firewalld
sudo systemctl disable firewalld
For UFW (Ubuntu)
bashsudo ufw allow 10250/tcp
sudo ufw allow 30000:32767/tcp

Step 3: Enable Required Kernel Modules and Settings
bash# Load kernel modules
cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

sudo modprobe overlay
sudo modprobe br_netfilter

# Set sysctl parameters
cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

sudo sysctl --system

Step 4: Install Container Runtime (containerd)
For RHEL/CentOS/Rocky/Amazon Linux
bash# Install containerd
sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install -y containerd.io
For Ubuntu/Debian
bashsudo apt-get update
sudo apt-get install -y containerd
Configure containerd
bash# Generate default config
sudo mkdir -p /etc/containerd
containerd config default | sudo tee /etc/containerd/config.toml

# Enable systemd cgroup driver
sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml

# Restart and enable containerd
sudo systemctl restart containerd
sudo systemctl enable containerd
sudo systemctl status containerd

Step 5: Install kubeadm, kubelet, kubectl
For RHEL/CentOS/Rocky/Amazon Linux
bash# Add Kubernetes repository
cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/
enabled=1
gpgcheck=1
gpgkey=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/repodata/repomd.xml.key
exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni
EOF

# Install Kubernetes components (version 1.29.6 to match your master)
sudo yum install -y kubelet-1.29.6 kubeadm-1.29.6 kubectl-1.29.6 --disableexcludes=kubernetes

# Enable kubelet
sudo systemctl enable --now kubelet
For Ubuntu/Debian
bash# Install required packages
sudo apt-get update
sudo apt-get install -y apt-transport-https ca-certificates curl gpg

# Add Kubernetes repository
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.29/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.29/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list

# Install Kubernetes components
sudo apt-get update
sudo apt-get install -y kubelet=1.29.6-* kubeadm=1.29.6-* kubectl=1.29.6-*
sudo apt-mark hold kubelet kubeadm kubectl

Step 6: Verify Installation
bash# Check kubeadm version
kubeadm version

# Check kubelet status (it will be in a crash loop until joined)
sudo systemctl status kubelet

# Verify containerd is running
sudo systemctl status containerd

Step 7: Join the Cluster
Now run your join command:
bashsudo kubeadm join <master-ip>:6443 --token <your-token> --discovery-token-ca-cert-hash sha256:<your-hash>
```

You should see output like:
```
[preflight] Running pre-flight checks
[preflight] Reading configuration from the cluster...
[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"
[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"
[kubelet-start] Starting the kubelet
[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...

This node has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run 'kubectl get nodes' on the control-plane to see this node join the cluster.

Step 8: Verify from Master Node
On your master node, run:
bash# Check nodes
kubectl get nodes

# Check detailed node info
kubectl get nodes -o wide

# Wait for node to be Ready (may take 1-2 minutes)
watch kubectl get nodes
```

Expected output:
```
NAME            STATUS   ROLES           AGE   VERSION
k8s-master      Ready    control-plane   5d    v1.29.6
k8s-worker-01   Ready    <none>          2m    v1.29.6

Step 9: Label the Worker Node (Optional)
From the master node:
bash# Add worker role label
kubectl label node k8s-worker-01 node-role.kubernetes.io/worker=worker

# Add custom labels
kubectl label node k8s-worker-01 environment=production
kubectl label node k8s-worker-01 node-type=compute

# Verify labels
kubectl get nodes --show-labels

Troubleshooting
If Join Fails
1. Check connectivity to master:
bashping <master-ip>
telnet <master-ip> 6443
2. Check kubelet logs:
bashsudo journalctl -u kubelet -f
3. Check containerd:
bashsudo systemctl status containerd
sudo crictl ps
4. Reset and try again:
bashsudo kubeadm reset
sudo systemctl restart kubelet
# Then run the join command again
5. Check firewall on master:
bash# On master node
sudo firewall-cmd --list-all
sudo firewall-cmd --permanent --add-port=6443/tcp
sudo firewall-cmd --reload
